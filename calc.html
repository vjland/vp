<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Score Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #121212;
            color: #e3e3e3;
            margin: 0;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll */
        }

        .m3-card {
            background: #1e1e1e;
            border-radius: 28px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .m3-display {
            background-color: #2d2d2d;
            border-radius: 20px;
            padding: 16px 24px;
            transition: all 0.3s ease;
        }

        .m3-btn-filled {
            background-color: #a8c7fa;
            color: #062e6f;
            border-radius: 100px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .m3-btn-filled:hover {
            background-color: #c2e7ff;
            box-shadow: 0 1px 3px 1px rgba(0, 0, 0, .15);
        }

        .m3-btn-filled:active {
            background-color: #7baaf7;
        }

        .m3-btn-tonal {
            background-color: #333537;
            color: #d2e3fc;
            border-radius: 100px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .m3-btn-tonal:hover {
            background-color: #3f4143;
        }

        .m3-btn-outlined {
            border: 1px solid #444746;
            color: #a8c7fa;
            border-radius: 100px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .m3-btn-outlined:hover {
            background-color: rgba(168, 199, 250, 0.08);
            border-color: #a8c7fa;
        }

        .m3-btn-error-text {
            color: #f2b8b5;
            border-radius: 100px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .m3-btn-error-text:hover {
            background-color: rgba(242, 184, 181, 0.08);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e1e1e;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #444746;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #5f6368;
        }

        .ripple {
            position: relative;
            overflow: hidden;
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@^19.2.3",
        "react-dom": "https://esm.sh/react-dom@^19.2.3",
        "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client"
      }
    }
    </script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';

        const GameLog = ({ sessions }) => {
          return (
            <div className="w-full flex-[2_2_0%] flex flex-col m3-card mt-[-24px] rounded-t-none z-0 border-t border-white/5 overflow-hidden">
              <div className="px-6 pt-10 pb-3 border-b border-white/5 flex justify-between items-center shrink-0">
                <h2 className="text-xs font-medium text-gray-500 uppercase tracking-wider">Session History</h2>
                <span className="px-2 py-0.5 bg-white/5 text-gray-400 text-[9px] font-bold rounded">
                  {sessions.length} ENTRIES
                </span>
              </div>

              <div className="flex-1 overflow-y-auto custom-scrollbar">
                {sessions.length === 0 ? (
                  <div className="h-full flex items-center justify-center text-gray-500 text-xs italic p-12 text-center">
                    No session data yet.
                  </div>
                ) : (
                  <table className="w-full text-left border-collapse">
                    <thead className="sticky top-0 bg-[#1e1e1e] border-b border-white/10 z-10">
                      <tr>
                        <th className="px-6 py-2 text-[9px] font-bold text-gray-500 uppercase tracking-widest">Session</th>
                        <th className="px-4 py-2 text-[9px] font-bold text-gray-500 uppercase tracking-widest text-center">Steps</th>
                        <th className="px-6 py-2 text-[9px] font-bold text-gray-500 uppercase tracking-widest text-right">Total</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-white/5">
                      {[...sessions].reverse().map((session, index) => (
                        <tr key={session.id} className="hover:bg-white/5 transition-colors">
                          <td className="px-6 py-3">
                            <span className="text-xs font-bold text-gray-400">#{sessions.length - index}</span>
                          </td>
                          <td className="px-4 py-3 text-center">
                            <span className="text-xs text-gray-500">{session.formula.length}</span>
                          </td>
                          <td className="px-6 py-3 text-right">
                            <span className={`text-sm font-black ${session.total >= 0 ? 'text-blue-400' : 'text-red-400'}`}>
                              {session.total > 0 ? `+${session.total}` : session.total}
                            </span>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                )}
              </div>
            </div>
          );
        };

        const Calculator = ({ currentFormula, grandTotal, onAdd, onUndo, onReset, onEnter }) => {
          const [isConfirmingReset, setIsConfirmingReset] = useState(false);

          const runningSum = useMemo(() => 
            currentFormula.reduce((acc, curr) => acc + curr, 0), 
          [currentFormula]);

          const formulaDisplay = useMemo(() => {
            if (currentFormula.length === 0) return "Ready";
            return currentFormula.map((n, i) => {
              const prefix = n > 0 ? (i === 0 ? "" : " + ") : (i === 0 ? " - " : " - ");
              return `${prefix}${Math.abs(n)}`;
            }).join("");
          }, [currentFormula]);

          useEffect(() => {
            if (isConfirmingReset) {
              const timer = setTimeout(() => setIsConfirmingReset(false), 3000);
              return () => clearTimeout(timer);
            }
          }, [isConfirmingReset]);

          const handleResetClick = () => {
            if (isConfirmingReset) {
              onReset();
              setIsConfirmingReset(false);
            } else {
              setIsConfirmingReset(true);
            }
          };

          return (
            <div className="w-full flex-[3.5_3.5_0%] flex flex-col m3-card z-10 relative overflow-hidden">
              {/* Material Header */}
              <div className="px-6 py-3 flex justify-between items-center border-b border-white/5 shrink-0">
                <div className="flex items-center gap-2">
                  <div className="w-2 h-2 rounded-full bg-blue-400"></div>
                  <span className="text-[11px] font-medium text-gray-400 uppercase tracking-widest">Score Engine</span>
                </div>
                <div className="flex flex-col items-end">
                  <span className="text-[9px] text-gray-500 font-bold uppercase tracking-tighter">Grand Total</span>
                  <span className={`text-2xl font-black ${grandTotal >= 0 ? 'text-blue-400' : 'text-red-400'}`}>
                    {grandTotal > 0 ? `+${grandTotal}` : grandTotal}
                  </span>
                </div>
              </div>

              {/* Display Area - Responsive scaling */}
              <div className="px-6 pt-3 flex-1 flex flex-col justify-center min-h-0">
                <div className="m3-display flex flex-col items-end justify-center py-3 flex-1">
                  <div className="text-gray-400 text-[10px] sm:text-xs mb-1 truncate w-full text-right font-medium">
                    {formulaDisplay}
                  </div>
                  <div className="text-4xl sm:text-5xl font-light text-white tracking-tight">
                    {runningSum}
                  </div>
                </div>
              </div>

              {/* Controls Grid */}
              <div className="p-5 sm:p-6 grid grid-cols-4 gap-2 sm:gap-4 shrink-0">
                <button 
                  onClick={() => onAdd(1)}
                  className="m3-btn-tonal aspect-square text-lg ripple"
                >+1</button>
                <button 
                  onClick={() => onAdd(2)}
                  className="m3-btn-tonal aspect-square text-lg ripple"
                >+2</button>
                
                <button 
                  onClick={onUndo}
                  className="m3-btn-outlined aspect-square flex items-center justify-center ripple"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 12H5M5 12l6-6M5 12l6 6"/></svg>
                </button>

                <button 
                  onClick={handleResetClick}
                  className={`m3-btn-error-text aspect-square text-[10px] font-bold uppercase transition-all ripple ${
                    isConfirmingReset ? 'bg-red-900/20 text-red-300' : ''
                  }`}
                >{isConfirmingReset ? 'Sure?' : 'Reset'}</button>

                <button 
                  onClick={() => onAdd(-1)}
                  className="m3-btn-outlined border-red-900/20 text-red-300/80 aspect-square text-lg ripple"
                >-1</button>
                <button 
                  onClick={() => onAdd(-2)}
                  className="m3-btn-outlined border-red-900/20 text-red-300/80 aspect-square text-lg ripple"
                >-2</button>

                <button 
                  onClick={onEnter}
                  disabled={currentFormula.length === 0}
                  className={`col-span-2 h-full m3-btn-filled text-[11px] font-bold uppercase tracking-wider ripple ${
                    currentFormula.length === 0 ? 'opacity-20 grayscale cursor-not-allowed' : ''
                  }`}
                >
                  Confirm
                </button>
              </div>
            </div>
          );
        };

        const App = () => {
          const [currentFormula, setCurrentFormula] = useState([]);
          const [sessions, setSessions] = useState([]);

          const grandTotal = useMemo(() => 
            sessions.reduce((acc, session) => acc + session.total, 0),
          [sessions]);

          const handleAdd = (val) => setCurrentFormula(prev => [...prev, val]);
          const handleUndo = () => setCurrentFormula(prev => prev.slice(0, -1));
          
          const handleResetEverything = () => {
            setCurrentFormula([]);
            setSessions([]);
          };

          const handleEnterSession = () => {
            if (currentFormula.length === 0) return;
            const total = currentFormula.reduce((acc, curr) => acc + curr, 0);
            const newSession = {
              id: crypto.randomUUID(),
              total,
              formula: [...currentFormula],
              timestamp: new Date()
            };
            setSessions(prev => [...prev, newSession]);
            setCurrentFormula([]);
          };

          return (
            <div className="h-screen flex flex-col items-center justify-center p-3 sm:p-6 bg-[#0a0a0a]">
              <main className="w-full max-w-md h-full flex flex-col max-h-[800px]">
                <Calculator 
                  currentFormula={currentFormula}
                  grandTotal={grandTotal}
                  onAdd={handleAdd}
                  onUndo={handleUndo}
                  onReset={handleResetEverything}
                  onEnter={handleEnterSession}
                />
                <GameLog sessions={sessions} />
              </main>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>